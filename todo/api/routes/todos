require('dotenv').config()

const express = require('express')
const router = express.Router()
const format = require('pg-format')
const { dbUserPool } = require('../db/db')

router.get('/', (req,res) =>{
    
    dbUserPool.connect()
        .then(client => {
            client.query('BEGIN')
            .then(()=>{
                const query = "SELECT * FROM todo"
                client.query(query)
                    .then(result =>{

                        client.query('COMMIT')

                        return res.status(200).json({
                            message: "Database Connection Working"
                        })
                    })
                    .catch(err => {
                        client.query('ROLLBACK')
                        
                        console.log('Error: ', err)
                        
                        return res.status(500).json({
                            message: 'query error',
                            error:err
                          })
                    })
            })
            .catch(err => {
                console.log('Error: ', err)
                
                return res.status(500).json({
                    message: 'database transaction error',
                    error:err
                })

            }).finally(() => {
                client.release()
            })

        }).catch(err => {

            console.log(err)
            
            return res.status(200).json({
                message: "Database Connection Error",
                error: err
            })
        })

    
})

module.exports = router